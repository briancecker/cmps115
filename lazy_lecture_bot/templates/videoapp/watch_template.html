{% extends "main/base.html" %}
{% block title %}{{ post.title }} | {{ block.super }}{% endblock title %}
{% block content %}
{{block.super}}
<div class="container">
	<script src="http://popcornjs.org/code/dist/popcorn-complete.js"></script>
	<div class="row">
		<div class="col-md-7">
			<video id="feature" width=640 height=360 controls>
				<source src="{{video_url}}" type="video/mp4">
				<source src="{{video_url}}" type="video/ogg">
				Your browser does not support this video tag
			</video>
			<div><h1>{{ post.title }}</h1></div>
			<div><a href="{% url 'profile' post.author %}">{{ post.author }}</a></div>
			<div>posted on {{ post.publish_date }}</div>
			<div style="overflow: auto; height: 300px;">{{ post.description }}</div>
		</div>

		<div class="col-md-5">
			<div><h3>Transcript:</h3></div>
			<div style="overflow: auto; height: 780px">
			{% if not finished_processing %}
				<i class="fa fa-circle-o-notch fa-spin fa-3x fa-fw"></i>
				{{ processing_status }}...
			{% else %}
				<dl class="dl-horizontal">
					{% for transcript in transcript_data %}
						{% for utterance in transcript.utterances %}
							<div class="utterance" id={{utterance.id}}
							onclick="goToVideoTime( {{ utterance.start_time }} );" startTime="{{ utterance.start_time }}" endTime="{{ utterance.end_time }}">
								<dt>{{ utterance.start_time }} - {{ utterance.end_time }}
									<dd>{{ utterance.text }}</dd>
								</dt>
							</div>
						{% endfor %}
					{%endfor%}
				</dl>
			{% endif %}
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
	$(document).ready(function() {
		var video = Popcorn('video');

		$('.utterance').each(function(index) {
			startTime = $(this).attr("startTime");
			endTime = $(this).attr("endTime");
			video.code({
				start: startTime,
				end: endTime,

				onStart: function( options ) {
          			beginLine(index);
        		},

        		onEnd: function(options) {
        			endLine();
        		}

			});
		});

		function beginLine(num) {
			var $currentLine = $(".utterance:eq("+num+")");
			$currentLine.addClass("highlight");
		}
		function endLine() {
			$(".utterance").removeClass("highlight");
		}
	});

	function goToVideoTime(start_time) {
		var video = document.getElementById("feature");
		video.currentTime = start_time;
	}
</script>

<style>
	.utterance {
		color: #999;
		padding-top: 10px;
		padding-bottom: 10px;
		border-top: 1px solid rgba(0,0,0,0.2);
	}

	.utterance:hover {
		cursor: pointer;
		background-color: rgb(255, 251, 204);
	}

	.highlight {
		color: black;
	}
</style>

{% endblock content %}