{% extends "main/base.html" %}
{% block title %}{{ post.title }} | {{ block.super }}{% endblock title %}
{% block content %}
{{block.super}}
<script src="http://popcornjs.org/code/dist/popcorn-complete.js"></script>
<div class="container-fluid" style="padding-top:30px;">
	<div class="row">
		<div class="col-md-6 col-md-offset-2 video-container">
			<div class="embed-responsive embed-responsive-16by9">
				<video id="feature" width=750 height=422 controls>
					<source src="{{video_url}}" type="video/mp4">
					<source src="{{video_url}}" type="video/ogg">
					Your browser does not support this video tag
				</video>
			</div>

			<div class="video-metadata">
				<div><h1>{{ post.title }}</h1></div>
				<div><a href="{% url 'profile' post.author %}">{{ post.author }}</a></div>
				<div>posted on {{ post.publish_date }}</div>
				<div style="overflow: auto; height: 50px;">{{ post.description }}</div>
			</div>
		</div>

		<div class="col-md-3 transcript">
			<div><h3>Transcript:</h3></div>
			<div style="overflow: auto; height: 700px">
			{% if not finished_processing %}
				<i class="fa fa-circle-o-notch fa-spin fa-3x fa-fw"></i>
				{{ processing_status }}...
			{% else %}
				<dl class="dl-horizontal">
					{% for transcript in transcript_data %}
						{% for utterance in transcript.utterances %}
							<div class="utterance" id={{utterance.id}}
							onclick="goToVideoTime( {{ utterance.start_time }} );" startTime="{{ utterance.start_time }}" endTime="{{ utterance.end_time }}">
								<!--dt>{{ utterance.start_time }} - {{ utterance.end_time }}
									<dd>{{ utterance.text }}</dd>
								</dt-->
								{{ utterance.text }}
							</div>
						{% endfor %}
					{%endfor%}
				</dl>
			{% endif %}
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
	$(document).ready(function() {
		var video = Popcorn('video');

		// For each utterance set a Popcorn timing instance
		$('.utterance').each(function(index) {
			startTime = $(this).attr("startTime");
			endTime = $(this).attr("endTime");
			video.code({
				start: startTime,
				end: endTime,

				onStart: function( options ) {
          			beginLine(index);
        		},

        		onEnd: function(options) {
        			endLine();
        		}

			});
		});

		// Adds a highlight class to the utterance
		function beginLine(num) {
			var $currentLine = $(".utterance:eq("+num+")");
			$currentLine.addClass("highlight");
		}

		// Removes a highlight class to the utterance
		function endLine() {
			$(".utterance").removeClass("highlight");
		}
	});

	function goToVideoTime(start_time) {
		var video = document.getElementById("feature");
		video.currentTime = start_time;
	}

</script>

<style>
	.utterance {
		color: #999;
		padding-top: 10px;
		padding-bottom: 10px;
		padding-left: 10px;
		padding-right: 10px;
		border-top: 1px solid rgba(0,0,0,0.2);
	}

	.utterance:hover {
		cursor: pointer;
		background-color: rgb(255, 251, 204);
	}

	.highlight {
		color: black;
		font-weight: bold;
	}

	.transcript {
		background-color: white;
		padding-left: 0px !important;
		padding-right: 0px !important;
		box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24) !important;
	}

	.transcript > div h3 {
		padding-left: 10px !important;
	}

	.video-metadata {
		background-color: white;
		padding: 10px 10px 10px 10px;
		margin-top: 10px;
	}

	.video-container {
		box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24) !important;
		padding-left: 0px;
		padding-right: 0px;
		background-color: white;
		margin-right: 25px;
	}
</style>

{% endblock content %}